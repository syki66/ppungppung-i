# **RPS-coin-slot-machine**

Hybus-Smart4412TKU(타겟시스템) 장치를 이용해서 만든 가위바위보 코인 슬롯머신 게임

<br>

---

# 1. 사용되는 센서 및 장치

**`led`** : 베팅액을 확인하는데 사용 (100원 단위로 사용)

2진수를 활용하고, 16진수로 사용해서 제어할수 있다. 예를 들어 이진수 `1010 1010`를 16진수로 변환하면 `0xAA`가 되고, 16진수를 이용해 led를 제어하게 되면 이진수의 홀수부분만 불이 켜지게 된다. *(1부분은 led가 켜지고 0부분은 꺼지게 된다.)*

**`tact switch`** : 베팅 금액 조절 및 가위바위보 플레이 및 기타 조작을 위해 사용

**`segment`** : 현재 잔액을 조회하기 위해 사용

**`dot matrix`** : "묵", "찌", "빠" 를 8 * 8 매트릭스를 이용해서 표현함 *(dot matrix는 상단에 있는 led와 사용법이 동일한데 다만 led 한줄짜리 8개를 동시에 제어하는것처럼 하면 된다.)*

**`character lcd`** : 현재 진행 상태를 알려주기 위해 사용

<br>

*이중 tact switch를 제외하고서는 반드시 모듈을 제어하는 함수 안에 `open()`, `close()` 를 반드시 적어주어야 타겟시스템이 다운되지 않는다.*

<br>

---

# 2. 알고리즘

![algorithm](https://user-images.githubusercontent.com/59393359/85367812-f7626800-b564-11ea-990c-cce27461f78d.png)

<br>

---

# 3. 소스코드

각 장치별로 함수화 하여 구현하였고, 메인함수에서는 시작부와 반복부로 나누어 구현하였다.

<br>

**`사용되는 함수`**

- 택트 스위치값 반환함수
- lcd 문자열 표시 함수
- led 제어함수
- 도트 매트릭스 제어함수
- 가위바위보 경기 결과 계산해주는 함수
- 게임 인트로 띄어주는 함수
- 경기 결과에 따라 잔고 금액 증감해주는 함수
- 돈 배열에서 양의 한자리수 값들만 존재하도록 조정해주는 함수 (세그먼트에 출력하기 위해)
- 세그먼트 제어함수

<br>

**`메인 함수`**

- **시작부**
	- 게임 인트로 부분 구현 (led, dot 이용)
	- 잔액을 세그먼트에 표기 (초기값 3000원 지급)

- **반복부**
	- 베팅금액 설정, 그에 따른 LED 표기
	- 가위바위보 실행
	- 잔액 계산
	- 가위바위보 함수 구현
	- 게임 진행 여부 확인

[소스코드 링크](https://github.com/syki66/RPS-coin-slot-machine/blob/master/rps_coin_slot_machine.c)

<br>

---

# 4. 실행

먼저 가상머신 등을 이용해 리눅스에서 `c언어 소스코드를 컴파일` 하여 `바이너리파일`를 만들고 이를 `teraterm`이라는 프로그램을 이용하여 타겟시스템과 `115200 시리얼`을 통해 통신을 연결한 뒤, 

`File => Transfer => ZMODEM => send` 순으로 바이너리 코드를 타겟시스템으로 보내면되며, `chmod 777 바이너리파일` 형식으로 권한을 설정해 준뒤 `./바이너리파일` 를 입력하여 실행하면 된다.

<br>

---

# 5. 시연 영상

게임을 시작하게 되면 처음에 도트매트릭스와 led를 이용한 인트로가 뜨게 되고, 아무키나 누르게 되면 세그먼트에 현재 잔액을 표시해준다.

이후 베팅금액을 정하고서 가위바위보를 하게되면 승패 여부가 clcd에 출력되고, 컴퓨터의 값을 도트 매트릭스에 출력해준다.

이후 베팅금액을 차감 or 증감 시킨 후 세그먼트에 잔액을 표시해주고 계속할건지의 여부를 선택할 수 있다.

<br>

![demo](https://user-images.githubusercontent.com/59393359/85309868-2ee1fd80-b4ee-11ea-87ed-2a2a67deaf50.gif)

<br>

---

## 참고 링크

- [16진수 2진수 변환표](https://dojang.io/mod/page/view.php?id=742)

<br><br><br><br>